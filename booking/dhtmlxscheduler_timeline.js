!function(){function e(){for(var e=scheduler.get_visible_events(),t=[],r=0;r<this.y_unit.length;r++)t[r]=[];t[s]||(t[s]=[]);for(var r=0;r<e.length;r++){for(var s=this.order[e[r][this.y_property]],l=0;this._trace_x[l+1]&&e[r].start_date>=this._trace_x[l+1];)l++;for(;this._trace_x[l]&&e[r].end_date>this._trace_x[l];)t[s][l]||(t[s][l]=[]),t[s][l].push(e[r]),l++}return t}function t(e){for(var t=0,r=this._trace_x;t<r.length-1&&+e>=+r[t+1];)t++;return t}function r(e,r,s){var l=0,a=s._step,d=s.round_position,_=0,i=r?e.end_date:e.start_date;i.valueOf()>scheduler._max_date.valueOf()&&(i=scheduler._max_date);var h=i-scheduler._min_date_timeline;if(h>0){for(var c=t.call(s,i),n=0;c>n;n++)l+=scheduler._cols[n];var u=scheduler.date.add(scheduler._min_date_timeline,scheduler.matrix[scheduler._mode].x_step*c,scheduler.matrix[scheduler._mode].x_unit);d?+i>+u&&r&&(_=scheduler._cols[c]):(h=i-u,_=Math.round(h/a))}return l+=r?0==h||d?_-14:_-12:_+1}function s(e,r){var s=t.call(this,e),l=this._trace_x[s];return r&&+e!=+this._trace_x[s]&&(l=this._trace_x[s+1]?this._trace_x[s+1]:scheduler.date.add(this._trace_x[s],this.x_step,this.x_unit)),new Date(l)}function l(e){var t="";if(e&&"cell"!=this.render){e.sort(this.sort||function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});for(var r=[],l=e.length,a=0;l>a;a++){var d=e[a];d._inner=!1;var _=this.round_position?s.apply(this,[d.start_date,!1]):d.start_date;for(this.round_position?s.apply(this,[d.end_date,!0]):d.end_date;r.length;){var i=r[r.length-1];if(!(i.end_date.valueOf()<=_.valueOf()))break;r.splice(r.length-1,1)}for(var h=!1,c=0;c<r.length;c++){var n=r[c];if(n.end_date.valueOf()<=_.valueOf()){h=!0,d._sorder=n._sorder,r.splice(c,1),d._inner=!0;break}}if(r.length&&(r[r.length-1]._inner=!0),!h)if(r.length)if(r.length<=r[r.length-1]._sorder){if(r[r.length-1]._sorder)for(var u=0;u<r.length;u++){for(var o=!1,x=0;x<r.length;x++)if(r[x]._sorder==u){o=!0;break}if(!o){d._sorder=u;break}}else d._sorder=0;d._inner=!0}else{for(var m=r[0]._sorder,v=1;v<r.length;v++)r[v]._sorder>m&&(m=r[v]._sorder);d._sorder=m+1,d._inner=!1}else d._sorder=0;r.push(d),r.length>(r.max_count||0)?(r.max_count=r.length,d._count=r.length):d._count=d._count?d._count:1}for(var f=0;f<e.length;f++)e[f]._count=r.max_count;for(var p=0;l>p;p++)t+=scheduler.render_timeline_event.call(this,e[p],!1)}return t}function a(t){var r="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>",s=[];if(scheduler._load_mode&&scheduler._load(),"cell"==this.render)s=e.call(this);else for(var a=scheduler.get_visible_events(),d=this.order,_=0;_<a.length;_++){var i=a[_],h=i[this.y_property],c=this.order[h];if(this.show_unassigned&&!h){for(var n in d)if(d.hasOwnProperty(n)){c=d[n],s[c]||(s[c]=[]);var u=scheduler._lame_copy({},i);u[this.y_property]=n,s[c].push(u)}}else s[c]||(s[c]=[]),s[c].push(i)}for(var o=0,x=0;x<scheduler._cols.length;x++)o+=scheduler._cols[x];var m=new Date;m=(scheduler.date.add(m,this.x_step*this.x_size,this.x_unit)-m)/o,this._step=m,this._summ=o;var v=scheduler._colsS.heights=[];this._events_height={},this._section_height={};for(var x=0;x<this.y_unit.length;x++){var f=this._logic(this.render,this.y_unit[x],this);scheduler._merge(f,{height:this.dy}),this.section_autoheight&&(this.y_unit.length*f.height<t.offsetHeight&&(f.height=Math.max(f.height,Math.floor((t.offsetHeight-1)/this.y_unit.length))),this._section_height[this.y_unit[x].key]=f.height),scheduler._merge(f,{tr_className:"",style_height:"height:"+f.height+"px;",style_width:"width:"+(this.dx-1)+"px;",td_className:"dhx_matrix_scell"+(scheduler.templates[this.name+"_scaley_class"](this.y_unit[x].key,this.y_unit[x].label,this.y_unit[x])?" "+scheduler.templates[this.name+"_scaley_class"](this.y_unit[x].key,this.y_unit[x].label,this.y_unit[x]):""),td_content:scheduler.templates[this.name+"_scale_label"](this.y_unit[x].key,this.y_unit[x].label,this.y_unit[x]),summ_width:"width:"+o+"px;",table_className:""});var p=l.call(this,s[x]);if(this.fit_events){var g=this._events_height[this.y_unit[x].key]||0;f.height=g>f.height?g:f.height,f.style_height="height:"+f.height+"px;",this._section_height[this.y_unit[x].key]=f.height}var y=f.td_content.replace(/<div/,'<div style="'+f.style_width+'"');if(r+="<tr class='"+f.tr_className+"' style='"+f.style_height+"'><td class='"+f.td_className+"' style='"+f.style_width+" height:"+(f.height-1)+"px;'>"+y+"</td>","cell"==this.render)for(var _=0;_<scheduler._cols.length;_++)r+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](s[x][_],this._trace_x[_],this.y_unit[x])+"' style='width:"+(scheduler._cols[_]-1)+"px'><div style='width:"+(scheduler._cols[_]-1)+"px'>"+scheduler.templates[this.name+"_cell_value"](s[x][_])+"</div></td>";else{r+="<td><div style='"+f.summ_width+" "+f.style_height+" position:relative;' class='dhx_matrix_line'>",r+=p,r+="<table class='"+f.table_className+"' cellpadding='0' cellspacing='0' style='"+f.summ_width+" "+f.style_height+"' >";for(var _=0;_<scheduler._cols.length;_++)r+="<td class='dhx_matrix_cell "+scheduler.templates[this.name+"_cell_class"](s[x],this._trace_x[_],this.y_unit[x])+"' style='width:"+(scheduler._cols[_]-1)+"px'><div style='width:"+(scheduler._cols[_]-1)+"px'></div></td>";r+="</table>",r+="</div></td>"}r+="</tr>"}r+="</table>",this._matrix=s,t.innerHTML=r,scheduler._rendered=[];for(var k=scheduler._obj.getElementsByTagName("DIV"),x=0;x<k.length;x++)k[x].getAttribute("event_id")&&scheduler._rendered.push(k[x]);this._scales={};for(var x=0;x<t.firstChild.rows.length;x++){v.push(t.firstChild.rows[x].offsetHeight);var b=this.y_unit[x].key,w=this._scales[b]=scheduler._isRender("cell")?t.firstChild.rows[x]:t.firstChild.rows[x].childNodes[1].getElementsByTagName("div")[0];scheduler.callEvent("onScaleAdd",[w,b])}}function d(e){var t=scheduler.xy.scale_height,r=this._header_resized||scheduler.xy.scale_height;scheduler._cols=[],scheduler._colsS={height:0},this._trace_x=[];var s=scheduler._x-this.dx-18,l=[this.dx],a=scheduler._els.dhx_cal_header[0];a.style.width=l[0]+s+"px",scheduler._min_date_timeline=scheduler._min_date;for(var d=scheduler._min_date,i=0;i<this.x_size;i++)this._trace_x[i]=new Date(d),d=scheduler.date.add(d,this.x_step,this.x_unit),scheduler._cols[i]=Math.floor(s/(this.x_size-i)),s-=scheduler._cols[i],l[i+1]=l[i]+scheduler._cols[i];if(e.innerHTML="<div></div>",this.second_scale){for(var h=this.second_scale.x_unit,c=[this._trace_x[0]],n=[],u=[this.dx,this.dx],x=0,m=0;m<this._trace_x.length;m++){var v=this._trace_x[m],f=_(h,v,c[x]);f&&(++x,c[x]=v,u[x+1]=u[x]);var p=x+1;n[x]=scheduler._cols[m]+(n[x]||0),u[p]+=scheduler._cols[m]}e.innerHTML="<div></div><div></div>";var g=e.firstChild;g.style.height=r+"px";var y=e.lastChild;y.style.position="relative";for(var k=0;k<c.length;k++){var b=c[k],w=scheduler.templates[this.name+"_second_scalex_class"](b),E=document.createElement("DIV");E.className="dhx_scale_bar dhx_second_scale_bar"+(w?" "+w:""),scheduler.set_xy(E,n[k]-1,r-3,u[k],0),E.innerHTML=scheduler.templates[this.name+"_second_scale_date"](b),g.appendChild(E)}}scheduler.xy.scale_height=r,e=e.lastChild;for(var z=0;z<this._trace_x.length;z++){d=this._trace_x[z],scheduler._render_x_header(z,l[z],d,e);var C=scheduler.templates[this.name+"_scalex_class"](d);C&&(e.lastChild.className+=" "+C)}scheduler.xy.scale_height=t;var N=this._trace_x;e.onclick=function(e){var t=o(e);t&&scheduler.callEvent("onXScaleClick",[t.x,N[t.x],e||event])},e.ondblclick=function(e){var t=o(e);t&&scheduler.callEvent("onXScaleDblClick",[t.x,N[t.x],e||event])}}function _(e,t,r){switch(e){case"hour":return t.getHours()!=r.getHours()||_("day",t,r);case"day":return!(t.getDate()==r.getDate()&&t.getMonth()==r.getMonth()&&t.getFullYear()==r.getFullYear());case"week":return!(scheduler.date.getISOWeek(t)==scheduler.date.getISOWeek(r)&&t.getFullYear()==r.getFullYear());case"month":return!(t.getMonth()==r.getMonth()&&t.getFullYear()==r.getFullYear());case"year":return!(t.getFullYear()==r.getFullYear());default:return!1}}function i(e){if(e){scheduler.set_sizes(),n();var t=scheduler._min_date;d.call(this,scheduler._els.dhx_cal_header[0]),a.call(this,scheduler._els.dhx_cal_data[0]),scheduler._min_date=t,scheduler._els.dhx_cal_date[0].innerHTML=scheduler.templates[this.name+"_date"](scheduler._min_date,scheduler._max_date),scheduler.markNow&&scheduler.markNow()}h()}function h(){scheduler._tooltip&&(scheduler._tooltip.style.display="none",scheduler._tooltip.date="")}function c(e,t,r){if("cell"==e.render){var s=t.x+"_"+t.y,l=e._matrix[t.y][t.x];if(!l)return h();if(l.sort(function(e,t){return e.start_date>t.start_date?1:-1}),scheduler._tooltip){if(scheduler._tooltip.date==s)return;scheduler._tooltip.innerHTML=""}else{var a=scheduler._tooltip=document.createElement("DIV");a.className="dhx_year_tooltip",document.body.appendChild(a),a.onclick=scheduler._click.dhx_cal_data}for(var d="",_=0;_<l.length;_++){var i=l[_].color?"background-color:"+l[_].color+";":"",c=l[_].textColor?"color:"+l[_].textColor+";":"";d+="<div class='dhx_tooltip_line' event_id='"+l[_].id+"' style='"+i+c+"'>",d+="<div class='dhx_tooltip_date'>"+(l[_]._timed?scheduler.templates.event_date(l[_].start_date):"")+"</div>",d+="<div class='dhx_event_icon icon_details'>&nbsp;</div>",d+=scheduler.templates[e.name+"_tooltip"](l[_].start_date,l[_].end_date,l[_])+"</div>"}scheduler._tooltip.style.display="",scheduler._tooltip.style.top="0px",document.body.offsetWidth-r.left-scheduler._tooltip.offsetWidth<0?scheduler._tooltip.style.left=r.left-scheduler._tooltip.offsetWidth+"px":scheduler._tooltip.style.left=r.left+t.src.offsetWidth+"px",scheduler._tooltip.date=s,scheduler._tooltip.innerHTML=d,document.body.offsetHeight-r.top-scheduler._tooltip.offsetHeight<0?scheduler._tooltip.style.top=r.top-scheduler._tooltip.offsetHeight+t.src.offsetHeight+"px":scheduler._tooltip.style.top=r.top+"px"}}function n(){dhtmlxEvent(scheduler._els.dhx_cal_data[0],"mouseover",function(e){var t=scheduler.matrix[scheduler._mode];if(t&&"cell"==t.render){if(t){var r=scheduler._locate_cell_timeline(e),e=e||event;e.target||e.srcElement;if(r)return c(t,r,getOffset(r.src))}h()}}),n=function(){}}function u(e){for(var t=e.parentNode.childNodes,r=0;r<t.length;r++)if(t[r]==e)return r;return-1}function o(e){e=e||event;for(var t=e.target?e.target:e.srcElement;t&&"DIV"!=t.tagName;)t=t.parentNode;if(t&&"DIV"==t.tagName){var r=t.className.split(" ")[0];if("dhx_scale_bar"==r)return{x:u(t),y:-1,src:t,scale:!0}}}scheduler.matrix={},scheduler._merge=function(e,t){for(var r in t)"undefined"==typeof e[r]&&(e[r]=t[r])},scheduler.createTimelineView=function(e){scheduler._merge(e,{section_autoheight:!0,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,event_dy:scheduler.xy.bar_height-5,event_min_dy:scheduler.xy.bar_height-5,resize_events:!0,fit_events:!0,show_unassigned:!1,second_scale:!1,round_position:!1,_logic:function(e,t,r){var s={};return scheduler.checkEvent("onBeforeViewRender")&&(s=scheduler.callEvent("onBeforeViewRender",[e,t,r])),s}}),e._original_x_start=e.x_start,scheduler.checkEvent("onTimelineCreated")&&scheduler.callEvent("onTimelineCreated",[e]);var t=scheduler.render_data;scheduler.render_data=function(r,s){if(this._mode!=e.name)return t.apply(this,arguments);if(s&&!e.show_unassigned&&"cell"!=e.render)for(var l=0;l<r.length;l++)this.clear_event(r[l]),this.render_timeline_event.call(this.matrix[this._mode],r[l],!0);else scheduler.renderMatrix.call(e,!0,!0)},scheduler.matrix[e.name]=e,scheduler.templates[e.name+"_cell_value"]=function(e){return e?e.length:""},scheduler.templates[e.name+"_cell_class"]=function(){return""},scheduler.templates[e.name+"_scalex_class"]=function(){return""},scheduler.templates[e.name+"_second_scalex_class"]=function(){return""},scheduler.templates[e.name+"_scaley_class"]=function(){return""},scheduler.templates[e.name+"_scale_label"]=function(e,t){return t},scheduler.templates[e.name+"_tooltip"]=function(e,t,r){return r.text},scheduler.templates[e.name+"_date"]=function(e,t){return 864e5>t-e?scheduler.templates.day_date(e):scheduler.templates.week_date(e,t)},scheduler.templates[e.name+"_scale_date"]=scheduler.date.date_to_str(e.x_date||scheduler.config.hour_date),scheduler.templates[e.name+"_second_scale_date"]=scheduler.date.date_to_str(e.second_scale&&e.second_scale.x_date?e.second_scale.x_date:scheduler.config.hour_date),scheduler.date["add_"+e.name]=function(t,r){var s=scheduler.date.add(t,(e.x_length||e.x_size)*r*e.x_step,e.x_unit);if(("minute"==e.x_unit||"hour"==e.x_unit)&&!e.x_length)if(+scheduler.date.date_part(new Date(t))==+scheduler.date.date_part(new Date(s)))e.x_start+=r*e.x_size;else{var l="hour"==e.x_unit?60*e.x_step:e.x_step,a=1440/(e.x_size*l)-1;r>0?e.x_start=e.x_start-a*e.x_size:e.x_start=a*e.x_size+e.x_start}return s},scheduler.attachEvent("onBeforeTodayDisplayed",function(){return e.x_start=e._original_x_start,!0}),scheduler.date[e.name+"_start"]=function(t){var r=scheduler.date[e.x_unit+"_start"]||scheduler.date.day_start,s=r.call(scheduler.date,t);return s=scheduler.date.add(s,e.x_step*e.x_start,e.x_unit)},scheduler.attachEvent("onSchedulerResize",function(){return this._mode==e.name?(scheduler.renderMatrix.call(e,!0,!0),!1):!0}),scheduler.attachEvent("onOptionsLoad",function(){e.order={},scheduler.callEvent("onOptionsLoadStart",[]);for(var t=0;t<e.y_unit.length;t++)e.order[e.y_unit[t].key]=t;scheduler.callEvent("onOptionsLoadFinal",[]),scheduler._date&&e.name==scheduler._mode&&scheduler.setCurrentView(scheduler._date,scheduler._mode)}),scheduler.callEvent("onOptionsLoad",[e]),scheduler[e.name+"_view"]=function(){scheduler.renderMatrix.apply(e,arguments)};var r=new Date;scheduler.date.add(r,e.x_step,e.x_unit).valueOf()-r.valueOf();scheduler["mouse_"+e.name]=function(t){var r=this._drag_event;this._drag_id&&(r=this.getEvent(this._drag_id),this._drag_event._dhx_changed=!0),t.x-=e.dx;var l=0,a=0,d=0;for(a;a<=this._cols.length-1;a++){var _=this._cols[a];if(l+=_,l>t.x){var i=(t.x-(l-_))/_;i=0>i?0:i;break}}for(l=0,d;d<this._colsS.heights.length&&(l+=this._colsS.heights[d],!(l>t.y));d++);t.fields={},e.y_unit[d]||(d=e.y_unit.length-1),d>=0&&e.y_unit[d]&&(t.section=t.fields[e.y_property]=e.y_unit[d].key,r&&(r[e.y_property]=t.section)),t.x=0,t.force_redraw=!0,t.custom=!0;var h;if(a>=e._trace_x.length)h=scheduler.date.add(e._trace_x[e._trace_x.length-1],e.x_step,e.x_unit);else{var c=e._trace_x[a+1]?e._trace_x[a+1]:scheduler.date.add(e._trace_x[e._trace_x.length-1],e.x_step,e.x_unit),n=Math.ceil(i*(c-e._trace_x[a]));h=new Date(+e._trace_x[a]+n)}if("move"==this._drag_mode&&this._drag_id&&this._drag_event){var r=this.getEvent(this._drag_id),u=this._drag_event;u._move_delta||(u._move_delta=(r.start_date-h)/6e4),h=scheduler.date.add(h,u._move_delta,"minute")}if("resize"==this._drag_mode&&r&&(t.resize_from_start=!!(Math.abs(r.start_date-h)<Math.abs(r.end_date-h))),e.round_position)switch(this._drag_mode){case"move":h=s.call(e,h,!1),"day"==e.x_unit&&(t.custom=!1);break;case"resize":this._drag_event&&(null==this._drag_event._resize_from_start&&(this._drag_event._resize_from_start=t.resize_from_start),t.resize_from_start=this._drag_event._resize_from_start,h=s.call(e,h,!this._drag_event._resize_from_start))}return t.y=Math.round((h-this._min_date)/(6e4*this.config.time_step)),t.shift=this.config.time_step,t}},scheduler.render_timeline_event=function(e,t){var s=e[this.y_property];if(!s)return"";var l=e._sorder,a=r(e,!1,this),d=r(e,!0,this),_=this.event_dy;"full"==this.event_dy&&(_=this.section_autoheight?this._section_height[s]-6:this.dy-3),this.resize_events&&(_=Math.max(Math.floor(_/e._count),this.event_min_dy));var i=_-2;e._inner||"full"!=this.event_dy||(i=(i+2)*(e._count-l)-2);var h=2+l*_+(l?2*l:0);scheduler.config.cascade_event_display&&(h=2+l*scheduler.config.cascade_event_margin+(l?2*l:0));var c=_+h+2;(!this._events_height[s]||this._events_height[s]<c)&&(this._events_height[s]=c);var n=scheduler.templates.event_class(e.start_date,e.end_date,e);n="dhx_cal_event_line "+(n||"");var u=e.color?"background:"+e.color+";":"",o=e.textColor?"color:"+e.textColor+";":"",x=scheduler.templates.event_bar_text(e.start_date,e.end_date,e),m='<div event_id="'+e.id+'" class="'+n+'" style="'+u+o+"position:absolute; top:"+h+"px; height: "+i+"px; left:"+a+"px; width:"+Math.max(0,d-a)+"px;"+(e._text_style||"")+'">';if(scheduler.config.drag_resize&&!scheduler.config.readonly){var v="dhx_event_resize";m+="<div class='"+v+" "+v+"_start' style='height: "+i+"px;'></div><div class='"+v+" "+v+"_end' style='height: "+i+"px;'></div>"}if(m+=x+"</div>",!t)return m;var f=document.createElement("DIV");f.innerHTML=m;var p=this.order[s],g=scheduler._els.dhx_cal_data[0].firstChild.rows[p].cells[1].firstChild;scheduler._rendered.push(f.firstChild),g.appendChild(f.firstChild)},scheduler.renderMatrix=function(e,t){if(t||(scheduler._els.dhx_cal_data[0].scrollTop=0),scheduler._min_date=scheduler.date[this.name+"_start"](scheduler._date),scheduler._max_date=scheduler.date.add(scheduler._min_date,this.x_size*this.x_step,this.x_unit),scheduler._table_view=!0,this.second_scale&&(e&&!this._header_resized&&(this._header_resized=scheduler.xy.scale_height,scheduler.xy.scale_height*=2,scheduler._els.dhx_cal_header[0].className+=" dhx_second_cal_header"),!e&&this._header_resized)){scheduler.xy.scale_height/=2,this._header_resized=!1;var r=scheduler._els.dhx_cal_header[0];r.className=r.className.replace(/ dhx_second_cal_header/gi,"")}i.call(this,e)},scheduler._locate_cell_timeline=function(e){e=e||event;for(var t=e.target?e.target:e.srcElement,r={},s=scheduler.matrix[scheduler._mode],l=scheduler.getActionData(e),a=0;a<s._trace_x.length-1&&!(+l.date<s._trace_x[a+1]);a++);r.x=a,r.y=s.order[l.section];var d=scheduler._isRender("cell")?1:0;r.src=s._scales[l.section]?s._scales[l.section].getElementsByTagName("td")[a+d]:null;for(var _=!1;0==r.x&&"dhx_cal_data"!=t.className&&t.parentNode;){if("dhx_matrix_scell"==t.className.split(" ")[0]){_=!0;break}t=t.parentNode}return _&&(r.x=-1,r.src=t,r.scale=!0),r};var x=scheduler._click.dhx_cal_data;scheduler._click.dhx_marked_timespan=scheduler._click.dhx_cal_data=function(e){var t=x.apply(this,arguments),r=scheduler.matrix[scheduler._mode];if(r){var s=scheduler._locate_cell_timeline(e);s&&(s.scale?scheduler.callEvent("onYScaleClick",[s.y,r.y_unit[s.y],e||event]):scheduler.callEvent("onCellClick",[s.x,s.y,r._trace_x[s.x],(r._matrix[s.y]||{})[s.x]||[],e||event]))}return t},scheduler.dblclick_dhx_marked_timespan=scheduler.dblclick_dhx_matrix_cell=function(e){var t=scheduler.matrix[scheduler._mode];if(t){var r=scheduler._locate_cell_timeline(e);r&&(r.scale?scheduler.callEvent("onYScaleDblClick",[r.y,t.y_unit[r.y],e||event]):scheduler.callEvent("onCellDblClick",[r.x,r.y,t._trace_x[r.x],(t._matrix[r.y]||{})[r.x]||[],e||event]))}},scheduler.dblclick_dhx_matrix_scell=function(e){return scheduler.dblclick_dhx_matrix_cell(e)},scheduler._isRender=function(e){return scheduler.matrix[scheduler._mode]&&scheduler.matrix[scheduler._mode].render==e},scheduler.attachEvent("onCellDblClick",function(e,t,r,s,l){if(!this.config.readonly&&("dblclick"!=l.type||this.config.dblclick_create)){var a=scheduler.matrix[scheduler._mode],d={};d.start_date=a._trace_x[e],d.end_date=a._trace_x[e+1]?a._trace_x[e+1]:scheduler.date.add(a._trace_x[e],a.x_step,a.x_unit),d[a.y_property]=a.y_unit[t].key,scheduler.addEventNow(d,null,l)}}),scheduler.attachEvent("onBeforeDrag",function(){return!scheduler._isRender("cell")}),scheduler.attachEvent("onEventChanged",function(e,t){t._timed=this.is_one_day_event(t)});var m=scheduler._render_marked_timespan;scheduler._render_marked_timespan=function(e,t,s){if(!scheduler.config.display_marked_timespans)return[];if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){if(scheduler._isRender("cell"))return;var l=scheduler.matrix[scheduler._mode],a=[],d=[],_=[];if(s)_=[t],d=[s];else{var i=l.order;for(var h in i)i.hasOwnProperty(h)&&(d.push(h),_.push(l._scales[h]))}var c=scheduler._min_date,n=scheduler._max_date,u=[];if(e.days>6){var o=new Date(e.days);scheduler.date.date_part(new Date(c))<=+o&&+n>=+o&&u.push(o)}else u.push.apply(u,scheduler._get_dates_by_index(e.days));for(var x=e.zones,v=scheduler._get_css_classes_by_config(e),f=0;f<d.length;f++){t=_[f],s=d[f];for(var p=0;p<u.length;p++)for(var g=u[p],y=0;y<x.length;y+=2){var k=x[y],b=x[y+1],w=new Date(+g+60*k*1e3),E=new Date(+g+60*b*1e3);if(scheduler._min_date<E&&scheduler._max_date>w){var z=scheduler._get_block_by_config(e);z.className=v;var C=r({start_date:w},!1,l)-1,N=r({start_date:E},!1,l)-1,D=Math.max(1,N-C-1),M=l._section_height[s]-1;z.style.cssText="height: "+M+"px; left: "+C+"px; width: "+D+"px; top: 0;",t.insertBefore(z,t.firstChild),a.push(z)}}}return a}return m.apply(scheduler,[e,t,s])};var v=scheduler._append_mark_now;scheduler._append_mark_now=function(e,t){if(scheduler.matrix&&scheduler.matrix[scheduler._mode]){var r=scheduler._currentDate(),s=scheduler._get_zone_minutes(r),l={days:+scheduler.date.date_part(r),zones:[s,s+1],css:"dhx_matrix_now_time",type:"dhx_now_time"};return scheduler._render_marked_timespan(l)}return v.apply(scheduler,[e,t])},scheduler.attachEvent("onScaleAdd",function(e,t){var r=scheduler._marked_timespans;if(r&&scheduler.matrix&&scheduler.matrix[scheduler._mode])for(var s=scheduler._mode,l=scheduler._min_date,a=scheduler._max_date,d=r.global,_=scheduler.date.date_part(new Date(l));a>_;_=scheduler.date.add(_,1,"day")){var i=+_,h=_.getDay(),c=[],n=d[i]||d[h];if(c.push.apply(c,scheduler._get_configs_to_render(n)),r[s]&&r[s][t]){var u=scheduler._get_types_to_render(r[s][t][h],r[s][t][i]);c.push.apply(c,scheduler._get_configs_to_render(u))}for(var o=0;o<c.length;o++){var x=c[o],m=x.days;7>m?(m=i,scheduler._render_marked_timespan(x,e,t),m=h):scheduler._render_marked_timespan(x,e,t)}}})}();